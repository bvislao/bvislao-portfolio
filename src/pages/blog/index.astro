---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  import.meta.env.PUBLIC_SUPABASE_URL,
  import.meta.env.PUBLIC_SUPABASE_ANON_KEY
);

const { data: posts } = await supabase
  .from("blog_posts")
  .select("title,slug,excerpt,published_at,tags,status")
  .eq("status", "published")
  .order("published_at", { ascending: false });
---

<BaseLayout title="Blog — bvislaoch" description="Notas técnicas y aprendizajes.">
  <section class="mx-auto max-w-6xl px-4 py-16">
    <h1 class="text-3xl font-semibold tracking-tight">Blog</h1>

    <div class="mt-8 grid gap-4 sm:grid-cols-2">
      {(posts ?? []).map((p) => (
        <a href={`/blog/${p.slug}`}
           class="rounded-2xl border p-6 hover:-translate-y-0.5 transition"
           style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
          <h2 class="font-semibold tracking-tight">{p.title}</h2>
          <p class="mt-2 text-sm opacity-80">{p.excerpt}</p>
          <p class="mt-4 text-xs opacity-60">{p.published_at?.slice(0,10)}</p>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>