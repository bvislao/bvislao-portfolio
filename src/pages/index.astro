---
import Logo from "@/components/Logo.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import { projects } from "@/data/project";
import { profile } from "@/data/profile";
import StoryScroll from "@/components/StoryScroll.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

type Project = {
  name: string;
  badge: string;
  tagline: string;
  description: string;
  highlights: string[];
  stack: string[];
  repo: string;
};

type ExperienceItem = {
  company: string;
  title: string;
  period: string;
  place: string;
};

const stackChips = [
  "Astro", "Next.js", "Supabase", "Postgres", "RLS", "Edge Functions",
  "TypeScript", ".NET / C#", "SQL"
];

const topExp = (profile.experience ?? []) as ExperienceItem[];
const expSummary = topExp.slice(0, 4).map(e => `${e.company}`).join(" • ");
---

<BaseLayout title="bvislaoch — Portafolio" description="Landing pro estilo Apple: proyectos, enfoque, contacto.">
  <!-- Background effects -->
  <div class="pointer-events-none fixed inset-0 -z-10">
    <div class="absolute inset-0" style="background: rgb(var(--bg));"></div>

    <!-- multi-accent glows -->
    <div class="absolute -top-56 left-1/2 h-[820px] w-[820px] -translate-x-1/2 rounded-full blur-3xl"
         style="background: radial-gradient(circle at center, rgb(var(--a1)/0.18), transparent 60%);"></div>

    <div class="absolute top-40 left-10 h-[520px] w-[520px] rounded-full blur-3xl"
         style="background: radial-gradient(circle at center, rgb(var(--a2)/0.16), transparent 60%);"></div>

    <div class="absolute top-80 right-10 h-[520px] w-[520px] rounded-full blur-3xl"
         style="background: radial-gradient(circle at center, rgb(var(--a3)/0.14), transparent 60%);"></div>

    <!-- subtle grid -->
    <div class="absolute inset-0 opacity-[0.08]"
         style="background-image: linear-gradient(to right, rgb(var(--border)/.6) 1px, transparent 1px),
                linear-gradient(to bottom, rgb(var(--border)/.6) 1px, transparent 1px);
                background-size: 56px 56px;">
    </div>
  </div>

  <!-- Scroll progress -->
  <div class="fixed left-0 top-0 z-[60] h-[2px] w-full bg-transparent">
    <div data-scroll-progress class="h-full origin-left scale-x-0"
         style="background: linear-gradient(90deg, rgb(var(--a1)), rgb(var(--a2)), rgb(var(--a3)));">
    </div>
  </div>

  <!-- Navbar glass -->
  <header class="sticky top-0 z-50 border-b backdrop-blur"
          style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.65);">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
      <a href="/" class="flex items-center gap-2 text-sm font-semibold tracking-tight">
        <Logo class="opacity-90" />
        <span>bvislaoch.dev</span>
      </a>

      <nav class="hidden gap-6 text-sm opacity-80 sm:flex">
        <a href="#work" class="hover:opacity-100">Work</a>
        <a href="#stack" class="hover:opacity-100">Stack</a>
        <a href="#experience" class="hover:opacity-100">Experiencia</a>
        <a href="#about" class="hover:opacity-100">Sobre mí</a>
        <a href="#contact" class="hover:opacity-100">Contacto</a>
        <a href="#story" class="hover:opacity-100">Story</a>
      </nav>

      <div class="flex items-center gap-2">
        <button
          type="button"
          data-theme-toggle
          class="rounded-full border px-3 py-1.5 text-sm opacity-90 hover:opacity-100"
          style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);"
          aria-label="Toggle theme"
          title="Modo oscuro"
        >
          <span class="hidden dark:inline">☾</span>
          <span class="dark:hidden">☀︎</span>
        </button>

        <a href="#contact" class="rounded-full border px-4 py-1.5 text-sm"
           style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
          Hablemos
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative overflow-hidden">
    <div class="mx-auto max-w-6xl px-4 py-16 sm:py-24">
      <div class="max-w-3xl">
        <div class="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs"
             style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
          <span class="h-1.5 w-1.5 rounded-full" style="background: rgb(var(--a1));"></span>
          <span class="opacity-80">{profile.role} • {profile.location}</span>
        </div>

        <h1 class="mt-4 text-4xl font-semibold tracking-tight sm:text-6xl">
          Experiencias web rápidas,
          <span class="opacity-70">claras y memorables.</span>
        </h1>

        <p class="mt-5 text-lg opacity-80 sm:text-xl">
          Performance primero, UI limpia y datos con Supabase.
          Experiencia en fintech/sector financiero: {expSummary}.
        </p>

        <div class="mt-8 flex flex-wrap gap-3">
          <a href="#work"
             class="rounded-full px-5 py-2.5 text-sm text-white dark:text-zinc-950"
             style="background: linear-gradient(90deg, rgb(var(--a1)), rgb(var(--a2)));">
            Ver proyectos
          </a>
          <a href="#contact"
             class="rounded-full border px-5 py-2.5 text-sm"
             style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.55);">
            Contacto
          </a>
          <a href="/blog"
             class="rounded-full border px-5 py-2.5 text-sm"
             style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.55);">
            Blog
          </a>
        </div>
      </div>

      <div class="mt-14 grid gap-6 sm:grid-cols-2">
        <div data-reveal class="reveal rounded-2xl border p-6"
             style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
          <p class="text-sm opacity-70">Enfoque</p>
          <h2 class="mt-2 text-2xl font-semibold tracking-tight">Diseño + ingeniería</h2>
          <p class="mt-2 text-sm opacity-80">
            Micro-interacciones sobrias, accesibilidad y velocidad real (LCP/CLS).
          </p>
        </div>

        <div class="relative rounded-2xl border p-6"
             style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
          <div class="absolute inset-0 rounded-2xl opacity-70"
               style="background: linear-gradient(180deg, rgb(var(--a3)/0.14), transparent);"></div>

          <div class="relative">
            <p class="text-sm opacity-70">Preview</p>
            <div class="mt-4 overflow-hidden rounded-xl border"
                 style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.55);">
              <div class="h-9 border-b" style="border-color: rgb(var(--border));"></div>
              <div class="p-6">
                <div data-parallax="0.10" class="will-change-transform">
                  <div class="h-40 rounded-xl border"
                       style="border-color: rgb(var(--border)); background: rgb(var(--bg)/0.6);"></div>
                  <p class="mt-3 text-xs opacity-70">Parallax sutil + reveal</p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- WORK -->
  <section id="work" class="mx-auto max-w-6xl px-4 py-16">
    <StoryScroll />
  </section>

  <!-- STACK -->
  <section id="stack" class="mx-auto max-w-6xl px-4 py-16">
    <div data-reveal class="reveal rounded-2xl border p-8 backdrop-blur"
         style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
      <h2 class="text-3xl font-semibold tracking-tight">Stack</h2>
      <p class="mt-2 text-sm opacity-80">
        Tecnologías que uso para construir productos con performance, seguridad y mantenibilidad.
      </p>

      <div class="mt-6 flex flex-wrap gap-2 text-xs">
        {stackChips.map((x) => (
          <span class="rounded-full border px-3 py-1"
                style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.5);">
            {x}
          </span>
        ))}
      </div>
    </div>
  </section>

  <!-- EXPERIENCE -->
  <section id="experience" class="mx-auto max-w-6xl px-4 py-16">
    <div data-reveal class="reveal">
      <h2 class="text-3xl font-semibold tracking-tight">Experiencia</h2>
      <p class="mt-2 text-sm opacity-80">Ruta profesional en tecnología y finanzas.</p>
    </div>

    <div class="mt-8 grid gap-4 sm:grid-cols-2">
      {(profile.experience as ExperienceItem[]).map((e) => (
        <div data-reveal class="reveal rounded-2xl border p-5"
             style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h3 class="font-medium">{e.company}</h3>
              <p class="text-sm opacity-80">{e.title}</p>
            </div>
            <p class="text-xs opacity-70 text-right">{e.period}</p>
          </div>
          <p class="mt-3 text-xs opacity-70">{e.place}</p>
        </div>
      ))}
    </div>
  </section>

  <!-- ABOUT + CONTACT -->
  <section id="about" class="mx-auto max-w-6xl px-4 py-16">
    <div class="grid gap-8 sm:grid-cols-2">
      <div data-reveal class="reveal">
        <h2 class="text-3xl font-semibold tracking-tight">Sobre mí</h2>

        <p class="mt-3 text-sm opacity-80">
          Soy {profile.role} con experiencia construyendo y manteniendo software para el sector financiero.
          Me enfoco en productos web, integración de servicios y entrega limpia: performance, seguridad y mantenibilidad.
        </p>

        <ul class="mt-6 space-y-2 text-sm opacity-80">
          <li>• Fintech / banca: sistemas críticos, seguridad y datos.</li>
          <li>• Web moderna: Astro/Next.js, UI clara y accesible.</li>
          <li>• Backend pragmático: SQL/Postgres, RLS, funciones y automatización.</li>
        </ul>

        <div class="mt-6 flex flex-wrap gap-2 text-xs opacity-90">
          {(profile.skills ?? []).slice(0, 10).map((s) => (
            <span class="rounded-full border px-3 py-1"
                  style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.5);">
              {s}
            </span>
          ))}
        </div>
      </div>

      <div id="contact" data-reveal class="reveal rounded-2xl border p-6"
           style="border-color: rgb(var(--border)); background: rgb(var(--card)/0.6);">
        <h2 class="text-2xl font-semibold tracking-tight">Contacto</h2>
        <p class="mt-2 text-sm opacity-80">¿Un proyecto? Escríbeme y lo conversamos.</p>

        <div class="mt-5 flex flex-wrap gap-3 text-sm">
          <a class="underline opacity-80 hover:opacity-100" href={`mailto:${profile.email}`}>
            {profile.email}
          </a>
          <a class="underline opacity-80 hover:opacity-100" href={profile.linkedin}
             target="_blank" rel="noreferrer noopener">
            LinkedIn
          </a>
          <a class="underline opacity-80 hover:opacity-100" href={profile.github}
             target="_blank" rel="noreferrer noopener">
            GitHub
          </a>
        </div>

        <div class="mt-6 rounded-xl border p-4 text-sm opacity-80"
             style="border-color: rgb(var(--border)); background: rgb(var(--bg)/0.35);">
          <p class="font-medium">Disponible para proyectos</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Minimal reveal CSS -->
  <style>
    .reveal { opacity: 0; transform: translateY(14px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.is-in { opacity: 1; transform: translateY(0); }
    @media (prefers-reduced-motion: reduce) {
      .reveal { opacity: 1; transform: none; transition: none; }
    }
  </style>

  <script src="../../public/scripts/landing.js"></script>
  <script src="../../public/scripts/story.js"></script>
</BaseLayout>